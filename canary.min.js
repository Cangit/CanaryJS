/*!
 * Canary.js logging and debug functions.
 * Based on RFC 5424 and Seldaek/monolog
 *
 * v0.2.0 https://github.com/Cangit/CanaryJS
 */
var CanaryJS=Backbone.Model.extend({defaults:{name:"CanaryJS",level:0,console:!1,numberOfEntries:0},initialize:function(){this.set("logCollection",new CanaryLogCollection)},addEntry:function(a,b,c,e){this.get("level")<=e&&("undefined"==b?(this.get("logCollection").add([{id:this.get("numberOfEntries"),type:c,msg:a}]),b=""):this.get("logCollection").add([{id:this.get("numberOfEntries"),type:c,msg:a,context:b}]),!0==this.get("console")&&this.get("logCollection").writeToConsole({id:this.get("numberOfEntries"),
stamp:this.get("name"),type:c,msg:a,context:b},!1),this.set("numberOfEntries",this.get("numberOfEntries")+1))},debug:function(a,b){"undefined"===typeof b?this.addEntry(a,"undefined","debug",100):this.addEntry(a,b,"debug",100)},info:function(a,b){"undefined"===typeof b?this.addEntry(a,"undefined","info",200):this.addEntry(a,b,"info",200)},notice:function(a,b){"undefined"===typeof b?this.addEntry(a,"undefined","notice",250):this.addEntry(a,b,"notice",250)},warning:function(a,b){"undefined"===typeof b?
this.addEntry(a,"undefined","warning",300):this.addEntry(a,b,"warning",300)},error:function(a,b){"undefined"===typeof b?this.addEntry(a,"undefined","error",400):this.addEntry(a,b,"error",400)},critical:function(a,b){"undefined"===typeof b?this.addEntry(a,"undefined","critical",500):this.addEntry(a,b,"critical",500)},"export":function(){return JSON.stringify(this.get("logCollection"))},getEntry:function(a){a=this.get("logCollection").get(a);return"undefined"===typeof a?a:{id:a.get("id"),type:a.get("type"),
msg:a.get("msg"),context:a.get("context")}},getLastEntry:function(){var a=this.get("logCollection").get(this.get("numberOfEntries")-1);return"undefined"===typeof a?a:{id:a.get("id"),type:a.get("type"),msg:a.get("msg"),context:a.get("context")}},dump:function(a){"undefined"===typeof a?console.group(this.get("name")):console.group(a);this.get("logCollection").walk(!1);console.groupEnd();return"/dump"},flush:function(a){"undefined"===typeof a?console.group(this.get("name")):console.group(a);this.get("logCollection").walk(!0);
console.groupEnd();this.set("numberOfEntries",0);return"/flush"},reset:function(){this.set("numberOfEntries",0);this.get("logCollection").reset();return!0}}),CanaryFactoryCollection=Backbone.Collection.extend({model:CanaryJS,create:function(a){this.add([a])},output:function(a){this.map(function(b){var c=b.get("logCollection");console.group(b.get("name"));c.walk(a);console.groupEnd()})}}),CanaryFactory=Backbone.Model.extend({defaults:{id:1,collection:new CanaryFactoryCollection,producedModels:0},create:function(a){var b=
this.get("producedModels")+1;this.set("producedModels",b);switch(typeof a){case "string":this.get("collection").create({id:b,name:a});break;case "object":a.id=b;this.get("collection").create(a);break;case "undefined":this.get("collection").create({id:b})}return this.get("collection").get(b)},dump:function(){this.get("collection").output(!1);return"/dump"},flush:function(){this.get("collection").output(!0);return"/flush"},"export":function(){return JSON.stringify(this.get("collection"))}}),CanaryLogEntry=
Backbone.Model.extend({defaults:{id:0,type:"unknown",msg:"",context:""}}),CanaryLogCollection=Backbone.Collection.extend({model:CanaryLogEntry,walk:function(a){var b=[],c=this;this.map(function(a){var d=a.get("id"),f=a.get("type"),g=a.get("msg");a=a.get("context");c.writeToConsole({id:d,type:f,msg:g,context:a},!0);b.push(d)});if(!0==a)for(a=0;a<b.length;a++)this.remove(b[a])},writeToConsole:function(a,b){var c=!0==b?"":a.stamp+"["+a.id+"] ";switch(a.type){case "debug":console.debug(c+a.msg,a.context);
break;case "info":case "notice":console.info(c+a.msg,a.context);break;case "warning":console.warn(c+a.msg,a.context);break;case "error":case "critical":console.error(c+a.msg,a.context)}}});window.CanaryFactory=new CanaryFactory;